{{ template "head" . }}
<style>
  .chart-container {
    position: relative;
    height: 300px;
  }

  .stat-card {
    transition: transform 0.2s ease-in-out;
  }

  .stat-card:hover {
    transform: translateY(-2px);
  }

  .absence-card {
    transition: all 0.2s ease-in-out;
    cursor: pointer;
  }

  .absence-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transform: translateY(-2px);
  }

  .overtime-bar {
    transition: width 0.5s ease-in-out;
  }
</style>

<body class="h-full bg-gray-50">
<!-- Navigation einfügen -->
{{ template "navigation" . }}

<!-- Hauptinhalt -->
<main class="py-10">
  <div class="px-4 sm:px-6 lg:px-8">
    {{if eq .userRole "user"}}
    <!-- USER DASHBOARD -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Mein Dashboard</h1>
      <p class="mt-1 text-sm text-gray-500">Persönliche Übersicht</p>
    </div>

    <!-- Persönliche Statistiken -->
    <div class="grid grid-cols-1 gap-6 mb-6 lg:grid-cols-4">
      <!-- Überstunden -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Überstunden-Saldo</p>
            <p class="text-2xl font-bold {{if ge .overtimeBalance 0}}text-green-600{{else}}text-red-600{{end}}">
              {{if ge .overtimeBalance 0}}+{{end}}{{printf "%.1f" .overtimeBalance}} Std
            </p>
          </div>
          <div class="p-3 rounded-full {{if ge .overtimeBalance 0}}bg-green-100{{else}}bg-red-100{{end}}">
            <svg class="h-6 w-6 {{if ge .overtimeBalance 0}}text-green-600{{else}}text-red-600{{end}}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Urlaubstage -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Resturlaub</p>
            <p class="text-2xl font-bold text-gray-900">{{.remainingVacation}} Tage</p>
            <p class="text-xs text-gray-400">von {{.vacationDays}} Tagen</p>
          </div>
          <div class="p-3 rounded-full bg-blue-100">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Genommener Urlaub -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Genommener Urlaub</p>
            <p class="text-2xl font-bold text-gray-900">{{printf "%.0f" .usedVacationDays}} Tage</p>
            <p class="text-xs text-gray-400">dieses Jahr</p>
          </div>
          <div class="p-3 rounded-full bg-yellow-100">
            <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Offene Anträge -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Offene Anträge</p>
            <p class="text-2xl font-bold text-gray-900">{{.pendingAbsences}}</p>
          </div>
          <div class="p-3 rounded-full bg-purple-100">
            <svg class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Schnellzugriff -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Schnellzugriff</h3>
        <div class="space-y-3">
          <a href="/profile" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
            <div class="p-2 bg-green-100 rounded-lg mr-3">
              <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div>
              <p class="font-medium">Mein Profil</p>
              <p class="text-sm text-gray-500">Persönliche Daten verwalten</p>
            </div>
          </a>

          <a href="/absence-overview" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
            <div class="p-2 bg-blue-100 rounded-lg mr-3">
              <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <div>
              <p class="font-medium">Abwesenheit beantragen</p>
              <p class="text-sm text-gray-500">Urlaub oder Krankmeldung einreichen</p>
            </div>
          </a>

          <a href="/timetracking" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors">
            <div class="p-2 bg-purple-100 rounded-lg mr-3">
              <svg class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <p class="font-medium">Zeiterfassung</p>
              <p class="text-sm text-gray-500">Arbeitszeiten eintragen</p>
            </div>
          </a>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Meine letzten Aktivitäten</h3>
        <div class="space-y-2 text-sm">
          <p class="text-gray-500">Noch keine Aktivitäten vorhanden</p>
        </div>
      </div>
    </div>

    {{else if eq .userRole "hr"}}
    <!-- HR DASHBOARD -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900">HR Dashboard</h1>
      <p class="mt-1 text-sm text-gray-500">Personalübersicht und demografische Daten</p>
    </div>

    <!-- HR Statistiken -->
    <div class="grid grid-cols-1 gap-6 mb-6 lg:grid-cols-4">
      <!-- Gesamtmitarbeiter -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Gesamtmitarbeiter</p>
            <p class="text-2xl font-bold text-gray-900">{{.totalEmployees}}</p>
          </div>
          <div class="p-3 rounded-full bg-green-100">
            <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Aktive Mitarbeiter -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Aktive Mitarbeiter</p>
            <p class="text-2xl font-bold text-gray-900">{{.activeEmployees}}</p>
            <p class="text-xs text-gray-400">{{.onLeaveEmployees}} im Urlaub</p>
          </div>
          <div class="p-3 rounded-full bg-blue-100">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Krankmeldungen -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Krankmeldungen</p>
            <p class="text-2xl font-bold text-gray-900">{{.sickEmployees}}</p>
            <p class="text-xs text-gray-400">aktuell</p>
          </div>
          <div class="p-3 rounded-full bg-red-100">
            <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Offene Anträge -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Offene Anträge</p>
            <p class="text-2xl font-bold text-gray-900">{{.pendingAbsencesCount}}</p>
          </div>
          <div class="p-3 rounded-full bg-yellow-100">
            <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Abwesenheitsanträge für HR -->
    {{if gt .pendingAbsencesCount 0}}
    <div class="bg-white rounded-lg shadow-md mb-6">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Offene Abwesenheitsanträge</h3>
        <a href="/absence-overview" class="text-sm text-green-600 hover:text-green-700">Alle anzeigen →</a>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
          {{range $index, $absence := .pendingAbsences}}
          {{if lt $index 4}}
          <div onclick="window.location.href='/absence-overview'" class="absence-card border border-gray-200 rounded-lg p-4 hover:border-green-500">
            <div class="flex items-start justify-between">
              <div>
                <p class="font-medium text-gray-900">{{$absence.EmployeeName}}</p>
                <p class="text-sm text-gray-500">{{$absence.StartDate}} - {{$absence.EndDate}} ({{printf "%.0f" $absence.Days}} Tage)</p>
                <p class="text-xs text-gray-400 mt-1">{{$absence.Reason}}</p>
              </div>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{if eq $absence.Type "vacation"}}bg-blue-100 text-blue-800{{else}}bg-red-100 text-red-800{{end}}">
              {{if eq $absence.Type "vacation"}}Urlaub{{else}}Krankheit{{end}}
              </span>
            </div>
          </div>
          {{end}}
          {{end}}
        </div>
      </div>
    </div>
    {{end}}

    <!-- Charts für HR -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Abteilungsverteilung -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Abteilungsverteilung</h3>
        <div class="chart-container">
          <canvas id="departmentChart"></canvas>
        </div>
      </div>

      <!-- Mitarbeiterstatus -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Mitarbeiterstatus</h3>
        <div class="chart-container">
          <canvas id="statusChart"></canvas>
        </div>
      </div>

      <!-- Altersverteilung -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Altersverteilung</h3>
        <div class="chart-container">
          <canvas id="ageChart"></canvas>
        </div>
      </div>

      <!-- Krankheitsverlauf -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Krankheitsverlauf (12 Monate)</h3>
        <div class="chart-container">
          <canvas id="sicknessChart"></canvas>
        </div>
      </div>
    </div>

    {{else}}
    <!-- ADMIN/MANAGER DASHBOARD -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
      <p class="mt-1 text-sm text-gray-500">Unternehmensübersicht</p>
    </div>

    <!-- Admin/Manager Statistiken -->
    <div class="grid grid-cols-1 gap-6 mb-6 lg:grid-cols-5">
      <!-- Mitarbeiter -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Mitarbeiter</p>
            <p class="text-2xl font-bold text-gray-900">{{.totalEmployees}}</p>
          </div>
          <div class="p-3 rounded-full bg-green-100">
            <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Personalkosten -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Personalkosten/Monat</p>
            <p class="text-2xl font-bold text-gray-900">{{.monthlyLaborCosts}} €</p>
          </div>
          <div class="p-3 rounded-full bg-blue-100">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Überstunden Gesamt -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Überstunden Gesamt</p>
            <p class="text-2xl font-bold {{if ge .totalOvertime 0}}text-green-600{{else}}text-red-600{{end}}">
              {{if ge .totalOvertime 0}}+{{end}}{{printf "%.0f" .totalOvertime}} Std
            </p>
          </div>
          <div class="p-3 rounded-full {{if ge .totalOvertime 0}}bg-green-100{{else}}bg-red-100{{end}}">
            <svg class="h-6 w-6 {{if ge .totalOvertime 0}}text-green-600{{else}}text-red-600{{end}}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Offene Anträge -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Offene Anträge</p>
            <p class="text-2xl font-bold text-gray-900">{{.pendingAbsencesCount}}</p>
          </div>
          <div class="p-3 rounded-full bg-yellow-100">
            <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Krankmeldungen -->
      <div class="stat-card bg-white rounded-lg shadow-md p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500">Krank heute</p>
            <p class="text-2xl font-bold text-gray-900">{{.sickToday}}</p>
            <p class="text-xs text-gray-400">+ {{.approvedAbsencesToday}} im Urlaub</p>
          </div>
          <div class="p-3 rounded-full bg-red-100">
            <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Abwesenheitsanträge -->
    {{if gt .pendingAbsencesCount 0}}
    <div class="bg-white rounded-lg shadow-md mb-6">
      <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Offene Abwesenheitsanträge</h3>
        <a href="/absence-overview" class="text-sm text-green-600 hover:text-green-700">Alle anzeigen →</a>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          {{range $index, $absence := .pendingAbsences}}
          {{if lt $index 6}}
          <div onclick="window.location.href='/absence-overview'" class="absence-card border border-gray-200 rounded-lg p-4 hover:border-green-500">
            <div class="flex items-start justify-between mb-2">
              <div>
                <p class="font-medium text-gray-900">{{$absence.EmployeeName}}</p>
                <p class="text-xs text-gray-500">{{$absence.Department}}</p>
              </div>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{if eq $absence.Type "vacation"}}bg-blue-100 text-blue-800{{else}}bg-red-100 text-red-800{{end}}">
              {{if eq $absence.Type "vacation"}}Urlaub{{else}}Krankheit{{end}}
              </span>
            </div>
            <p class="text-sm text-gray-700">{{$absence.StartDate}} - {{$absence.EndDate}}</p>
            <p class="text-sm font-medium text-gray-900">{{printf "%.0f" $absence.Days}} Tage</p>
            {{if $absence.Reason}}
            <p class="text-xs text-gray-500 mt-1 truncate">{{$absence.Reason}}</p>
            {{end}}
          </div>
          {{end}}
          {{end}}
        </div>
      </div>
    </div>
    {{end}}

    <!-- Charts Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- Personalkosten Verlauf -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Personalkosten Verlauf</h3>
        <div class="chart-container">
          <canvas id="laborCostsChart"></canvas>
        </div>
      </div>

      <!-- Überstunden Verlauf -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Überstunden Verlauf</h3>
        <div class="chart-container">
          <canvas id="overtimeChart"></canvas>
        </div>
      </div>

      <!-- Krankheitsverlauf -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Krankheitsverlauf (12 Monate)</h3>
        <div class="chart-container">
          <canvas id="sicknessChart"></canvas>
        </div>
      </div>

      <!-- Abteilungsverteilung -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Abteilungsverteilung</h3>
        <div class="chart-container">
          <canvas id="departmentChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Top Überstunden Mitarbeiter -->
    {{if gt (len .overtimeEmployees) 0}}
    <div class="bg-white rounded-lg shadow-md">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold">Mitarbeiter mit höchsten Überstunden</h3>
      </div>
      <div class="p-6">
        <div class="space-y-3">
          {{range .overtimeEmployees}}
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <p class="font-medium text-gray-900">{{.Name}}</p>
            </div>
            <div class="flex items-center">
              <div class="w-32 bg-gray-200 rounded-full h-2 mr-3">
                <div class="overtime-bar h-2 rounded-full {{if eq .Status "high"}}bg-red-500{{else if eq .Status "positive"}}bg-yellow-500{{else if eq .Status "negative"}}bg-blue-500{{else}}bg-red-700{{end}}"
                style="width: {{if gt .Balance 0}}{{if gt .Balance 100}}100{{else}}{{.Balance}}{{end}}{{else}}{{if lt .Balance -100}}100{{else}}{{multiply .Balance -1}}{{end}}{{end}}%">
              </div>
            </div>
            <span class="text-sm font-medium {{if ge .Balance 0}}text-green-600{{else}}text-red-600{{end}}">
                {{if ge .Balance 0}}+{{end}}{{printf "%.1f" .Balance}} Std
              </span>
          </div>
        </div>
        {{end}}
      </div>
    </div>
  </div>
  {{end}}
  {{end}}

  <!-- Letzte Aktivitäten (für alle außer User) -->
  {{if ne .userRole "user"}}
  <div class="mt-6 bg-white rounded-lg shadow-md">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold">Letzte Aktivitäten</h3>
    </div>
    <div class="p-6">
      <div class="flow-root">
        <ul class="-mb-8">
          {{range .recentActivities}}
          <li>
            <div class="relative pb-8">
              {{if not .IsLast}}
              <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
              {{end}}
              <div class="relative flex space-x-3">
                <div>
                    <span class="h-8 w-8 rounded-full {{.IconBgClass}} flex items-center justify-center ring-8 ring-white">
                      {{.IconSVG | safeHTML}}
                    </span>
                </div>
                <div class="min-w-0 flex-1">
                  <div>
                    <div class="text-sm text-gray-500">
                      {{.Message | safeHTML}}
                    </div>
                    <p class="mt-0.5 text-sm text-gray-500">{{.Time}}</p>
                  </div>
                </div>
              </div>
            </div>
          </li>
          {{else}}
          <li class="text-center text-gray-500 py-2">
            Keine Aktivitäten gefunden
          </li>
          {{end}}
        </ul>
      </div>
    </div>
  </div>
  {{end}}
  </div>
</main>

<!-- Footer -->
{{ template "footer" . }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Einheitliche Farbpalette definieren (NUR GRÜNTÖNE)
    const globalChartColors = {
      darkestGreen: '#05402D',  // Sehr dunkles Grün
      darkGreen: '#15803D',     // Dunkelgrün
      mediumGreen: '#22C55E',   // Mittleres Grün
      lightGreen: '#86EFAC',    // Helles Grün
      limeGreen: '#C3E657',     // Gelbgrün / Limettengrün (als hellste Variante)
      // Hilfs-Array für zyklische Farbverwendung
      paletteCycle: ['#05402D', '#15803D', '#22C55E', '#86EFAC', '#C3E657']
    };

    // Helper Funktion für Währungsformatierung (aus Skript 1)
    function formatCurrency(value) {
      return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(value);
    }

    // --- BEGINN: Nur für Admin/Manager Rollen (nicht HR) ---
    {{if and (ne .userRole "user") (ne .userRole "hr")}}
    // Personalkosten-Diagramm
    const laborCtx = document.getElementById('laborCostsChart');
    if (laborCtx) {
      new Chart(laborCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: {{.monthLabels}} || ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
              datasets: [
        {
          label: 'Gesamtpersonalkosten inkl. AG-Anteil (€)',
          data: {{.monthlyCostsData}},
      borderColor: globalChartColors.darkGreen, // Dunkelgrün
              backgroundColor: `${globalChartColors.darkGreen}33`, // Transparenz angepasst
              fill: true,
              tension: 0.4
    },
      {
        label: 'Durchschnittskosten pro Mitarbeiter inkl. AG-Anteil (€)',
                data: {{.avgCostsPerEmployeeData}},
        borderColor: globalChartColors.mediumGreen, // Mittleres Grün
                backgroundColor: `${globalChartColors.mediumGreen}33`,
              fill: true,
              tension: 0.4,
              borderDash: [5, 5]
      }
    ]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: {
          tooltip: {
            mode: 'index',
                    intersect: false,
                    callbacks: {
              label: function(context) {
                let label = context.dataset.label || '';
                if (label) { label += ': '; }
                if (context.parsed.y !== null) { label += formatCurrency(context.parsed.y); }
                return label;
              }
            }
          },
          legend: { position: 'top' }
        },
        scales: {
          x: { grid: { display: false } },
          y: { beginAtZero: true, ticks: { callback: function(value) { return formatCurrency(value); } } }
        }
      }
    });
    }

    // Personalkostenverteilung nach Abteilung (Balkendiagramm)
    const deptCostsCtx = document.getElementById('deptCostsChart');
    if (deptCostsCtx) {
      const deptCostsLabels = {{.deptCostsLabels}};
      const deptCostsColors = deptCostsLabels.map((_, index) => globalChartColors.paletteCycle[index % globalChartColors.paletteCycle.length]);
      new Chart(deptCostsCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: deptCostsLabels,
          datasets: [{
            label: 'Personalkosten (€)',
            data: {{.deptCostsData}},
        backgroundColor: deptCostsColors,
        borderColor: deptCostsColors,
        borderWidth: 1,
        borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
        borderSkipped: 'bottom'
      }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { callback: function(value) { return formatCurrency(value); } } } },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.dataset.label || '';
                if (label) { label += ': '; }
                if (context.parsed.y !== null) { label += formatCurrency(context.parsed.y); }
                return label;
              }
            }
          },
          legend: { display: true, position: 'top' }
        }
      }
    });
    }

    // Altersstruktur (Admin/Manager Version)
    const ageDistCtx = document.getElementById('ageDistributionChart');
    if (ageDistCtx) {
      const ageDistGroups = {{.ageGroups}};
      const ageDistColors = ageDistGroups.map((_, index) => globalChartColors.paletteCycle[index % globalChartColors.paletteCycle.length]);
      new Chart(ageDistCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ageDistGroups,
          datasets: [{
            label: 'Anzahl Mitarbeiter',
            data: {{.ageCounts}},
        backgroundColor: ageDistColors,
        borderColor: ageDistColors,
        borderWidth: 1,
        borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
        borderSkipped: 'bottom'
      }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } },
        plugins: { legend: { display: false } }
      }
    });
    }

    // Überstunden Verlauf
    const overtimeCtx = document.getElementById('overtimeChart');
    if (overtimeCtx) {
      new Chart(overtimeCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: {{.monthLabels}} || ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
              datasets: [{
        label: 'Überstunden Gesamt',
        data: {{.overtimeTrend}},
      borderColor: globalChartColors.mediumGreen, // Mittleres Grün statt Blau
              backgroundColor: `${globalChartColors.mediumGreen}33`,
              tension: 0.4,
              fill: true
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { callback: function(value) { return value + ' Std'; } } } },
        plugins: { legend: { display: true, position: 'top' } }
      }
    });
    }

    // Krankheitsverlauf (Admin/Manager - Balken Version)
    const sickTrendCtx = document.getElementById('sicknessChart');
    if (sickTrendCtx) {
      new Chart(sickTrendCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: {{.monthLabels}} || ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
              datasets: [{
        label: 'Krankmeldungen (Tage/Anzahl)',
        data: {{.sicknessTrend}},
      backgroundColor: globalChartColors.darkGreen, // Dunkelgrün statt Rot
              borderColor: globalChartColors.darkGreen,
              borderWidth: 1,
              borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
      borderSkipped: 'bottom'
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } },
        plugins: { legend: { display: false } }
      }
    });
    }

    // Abteilungsverteilung (Doughnut - für Admin/Manager)
    const adminDeptCtx = document.getElementById('adminDepartmentChart');
    if (adminDeptCtx) {
      new Chart(adminDeptCtx.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: {{.departmentLabels}},
      datasets: [{
        data: {{.departmentData}},
      backgroundColor: globalChartColors.paletteCycle.slice(0, {{.departmentLabels}}.length),
      hoverOffset: 4
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.label || '';
                if (label) { label += ': '; }
                if (context.parsed !== null) {
                  label += context.parsed;
                  label += ' Mitarbeiter';
                }
                return label;
              }
            }
          }
        }
      }
    });
    }

    // Filter für Mitarbeiterübersicht
    const employeeFilter = document.getElementById('employee-filter');
    if (employeeFilter) {
      employeeFilter.addEventListener('change', function() {
        console.log('Admin/Manager Mitarbeiter-Filter geändert zu:', this.value);
      });
    }
    {{end}}
    // --- ENDE: Nur für Admin/Manager Rollen (nicht HR) ---


    // --- BEGINN: Nur für HR Rolle ---
    {{if eq .userRole "hr"}}
    // Tab-Funktionalität
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    if (tabButtons.length > 0 && tabContents.length > 0) {
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => {
            btn.classList.remove('active', 'border-green-500', 'text-green-600'); // Farben ggf. anpassen, falls Theme betroffen
            btn.classList.add('border-transparent', 'text-gray-500');
          });
          tabContents.forEach(content => {
            content.classList.add('hidden');
          });
          button.classList.remove('border-transparent', 'text-gray-500');
          button.classList.add('active', 'border-green-500', 'text-green-600'); // Farben ggf. anpassen
          const targetId = button.id.replace('tab-', 'tab-content-');
          const targetContent = document.getElementById(targetId);
          if(targetContent) targetContent.classList.remove('hidden');
        });
      });
      if(tabButtons[0]) tabButtons[0].click();
    }

    // Abteilungsverteilung-Diagramm (HR - Doughnut)
    const hrDeptCtx = document.getElementById('departmentChart');
    if (hrDeptCtx) {
      new Chart(hrDeptCtx.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: {{.departmentLabels}},
      datasets: [{
        data: {{.departmentData}},
      backgroundColor: globalChartColors.paletteCycle.slice(0, {{.departmentLabels}}.length),
      hoverOffset: 4
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.label || '';
                if (label) { label += ': '; }
                if (context.parsed !== null) {
                  label += context.parsed;
                  label += ' Mitarbeiter';
                }
                return label;
              }
            }
          }
        }
      }
    });
    }

    // Status-Verteilung-Diagramm (HR - Pie)
    const statusCtx = document.getElementById('statusChart');
    if (statusCtx) {
      new Chart(statusCtx.getContext('2d'), {
        type: 'pie',
        data: {
          labels: {{.statusLabels}},
      datasets: [{
        data: {{.statusData}},
      backgroundColor: [ // Verschiedene Grüntöne zur Unterscheidung
        globalChartColors.mediumGreen,    // Früher: Aktiv (grün)
        globalChartColors.lightGreen,     // Früher: Gekündigt/Ausstehend (orange)
        globalChartColors.darkGreen,      // Früher: Inaktiv/Probezeit Ende (rot)
        globalChartColors.limeGreen       // Früher: Sonstige (grau)
      ].slice(0, {{.statusLabels}}.length),
      hoverOffset: 4
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function(context) {
                let label = context.label || '';
                if (label) { label += ': '; }
                if (context.parsed !== null) {
                  label += context.parsed;
                  label += ' Mitarbeiter';
                }
                return label;
              }
            }
          }
        }
      }
    });
    }

    // Altersverteilung-Diagramm (HR - Bar)
    const hrAgeCtx = document.getElementById('ageChart');
    if (hrAgeCtx) {
      new Chart(hrAgeCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: {{.ageLabels}},
      datasets: [{
        label: 'Anzahl Mitarbeiter',
        data: {{.ageData}},
      backgroundColor: globalChartColors.mediumGreen, // Mittleres Grün
              borderColor: globalChartColors.mediumGreen,
              borderWidth: 1,
              borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
      borderSkipped: 'bottom'
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } },
        plugins: { legend: { display: false } }
      }
    });
    }

    // Betriebszugehörigkeit-Diagramm (HR - Bar)
    const tenureCtx = document.getElementById('tenureChart');
    if (tenureCtx) {
      new Chart(tenureCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: {{.tenureLabels}},
      datasets: [{
        label: 'Anzahl Mitarbeiter',
        data: {{.tenureData}},
      backgroundColor: globalChartColors.lightGreen, // Helles Grün
              borderColor: globalChartColors.lightGreen,
              borderWidth: 1,
              borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
      borderSkipped: 'bottom'
    }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } },
        plugins: { legend: { display: false } }
      }
    });
    }

    // Neueinstellungen-Diagramm (HR - Line)
    const hiresCtx = document.getElementById('hiresChart');
    if (hiresCtx) {
      new Chart(hiresCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
          datasets: [{
            label: 'Neueinstellungen',
            data: {{.monthlyHiresData}},
        borderColor: globalChartColors.darkGreen, // Dunkelgrün
        backgroundColor: `${globalChartColors.darkGreen}33`,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: globalChartColors.darkGreen,
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointRadius: 5
      }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
        scales: { x: { grid: { display: false } }, y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } }
      }
    });
    }

    // Abgänge-Diagramm (HR - Line)
    const departuresCtx = document.getElementById('departuresChart');
    if (departuresCtx) {
      new Chart(departuresCtx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
          datasets: [{
            label: 'Abgänge',
            data: {{.monthlyDeparturesData}},
        borderColor: globalChartColors.darkestGreen, // Sehr dunkles Grün (statt Gelb/Rot)
        backgroundColor: `${globalChartColors.darkestGreen}33`,
        fill: true,
        tension: 0.4,
        pointBackgroundColor: globalChartColors.darkestGreen,
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointRadius: 5
      }]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
        scales: { x: { grid: { display: false } }, y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0 } } }
      }
    });
    }

    // Abwesenheiten über Zeit (HR - Line, Urlaub & Krankheit)
    const absenceTimeCtx = document.getElementById('absenceTimeChart');
    if (absenceTimeCtx) {
      new Chart(absenceTimeCtx.getContext('2d'), {
                type: 'line',
                data: {
                  labels: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
                  datasets: [
                    {
                      label: 'Urlaub (Tage)',
                      data: {{.absenceByMonthData}},
                borderColor: globalChartColors.mediumGreen, // Mittleres Grün (statt Orange)
                backgroundColor: `${globalChartColors.mediumGreen}33`,
                fill: false,
                tension: 0.4
              },
              {
                label: 'Krankheit (Tage)',
                data: {{.sicknessByMonthData}},
      borderColor: globalChartColors.darkGreen, // Dunkelgrün (statt Rot)
              backgroundColor: `${globalChartColors.darkGreen}33`,
              fill: false,
              tension: 0.4
    }
    ]
    },
      options: {
        responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, tooltip: { mode: 'index', intersect: false } },
        scales: { x: { grid: { display: false } }, y: { beginAtZero: true, ticks: { stepSize: 1, precision: 0, callback: function(value) { return value + ' Tage';} } } }
      }
    });
    }

    // Netto-Personalentwicklung (HR - Bar)
    const netGrowthCtx = document.getElementById('netGrowthChart');
    if (netGrowthCtx && typeof {{.monthlyHiresData}} !== 'undefined' && typeof {{.monthlyDeparturesData}} !== 'undefined') {
      const netGrowthData = {{.monthlyHiresData}}.map((hires, index) => {
        return hires - {{.monthlyDeparturesData}}[index];
      });
      new Chart(netGrowthCtx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
          datasets: [{
            label: 'Netto-Personalentwicklung',
            data: netGrowthData,
            backgroundColor: netGrowthData.map(value => value >= 0 ? globalChartColors.mediumGreen : globalChartColors.darkestGreen), // Hellgrün für positiv, Dunkelgrün für negativ
            borderColor: netGrowthData.map(value => value >= 0 ? globalChartColors.mediumGreen : globalChartColors.darkestGreen),
            borderWidth: 1,
            borderRadius: { topLeft: 8, topRight: 8, bottomLeft: 0, bottomRight: 0 },
            borderSkipped: 'bottom'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed.y;
                  return value >= 0 ? `+${value} Mitarbeiter` : `${value} Mitarbeiter`;
                }
              }
            }
          },
          scales: {
            x: { grid: { display: false } },
            y: {
              ticks: {
                stepSize: 1,
                precision: 0,
                callback: function(value) {
                  return value >= 0 ? `+${value}` : value;
                }
              }
            }
          }
        }
      });
    }
    {{end}}
    // --- ENDE: Nur für HR Rolle ---

  });
</script>
</body>
</html>